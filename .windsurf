# INFINITY GAUNTLET LOVE LETTER - PROJET DOCUMENTATION COMPLÃˆTE

## OVERVIEW GÃ‰NÃ‰RAL

**Nom du projet**: Infinity Gauntlet Love Letter  
**Type**: Jeu multijoueur en temps rÃ©el basÃ© sur Love Letter  
**Architecture**: Full-stack TypeScript avec Domain-Driven Design  
**Status**: En dÃ©veloppement actif - Backend production-ready, Frontend intÃ©grÃ©

## STACK TECHNOLOGIQUE COMPLÃˆTE

### Backend Core
```json
{
  "framework": "AdonisJS v6.17.2",
  "language": "TypeScript 5.7.3",
  "architecture": "Hexagonal Architecture + DDD",
  "database": {
    "orm": "Lucid ORM v21.6.0",
    "supported": ["PostgreSQL", "SQLite"],
    "current": "SQLite (dev), PostgreSQL (prod)"
  },
  "authentication": {
    "provider": "@adonisjs/auth v9.3.1",
    "strategy": "session-based",
    "guards": ["web"]
  },
  "validation": "@vinejs/vine v3.0.0",
  "testing": {
    "unit": "Jest v29.7.0",
    "integration": "@japa/runner v4.2.0",
    "mutation": "@stryker-mutator/core v9.0.1"
  }
}
```

### Frontend Core
```json
{
  "framework": "React v19.0.0",
  "bridge": "@inertiajs/react v2.0.3",
  "styling": "TailwindCSS v4.0.8",
  "bundler": "Vite v6.1.1",
  "ui_library": "@tyfo.dev/ui (shadcn/ui based)",
  "real_time": "Server-Sent Events (SSE)"
}
```

## ARCHITECTURE DÃ‰TAILLÃ‰E

### Structure des RÃ©pertoires
```
apps/infinity/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ controllers/          # HTTP Controllers
â”‚   â”œâ”€â”€ middleware/           # HTTP Middleware
â”‚   â”œâ”€â”€ models/              # Lucid Models
â”‚   â”œâ”€â”€ domain/              # Domain Layer (DDD)
â”‚   â”‚   â”œâ”€â”€ entities/        # Domain Entities
â”‚   â”‚   â”œâ”€â”€ value_objects/   # Value Objects
â”‚   â”‚   â”œâ”€â”€ events/          # Domain Events
â”‚   â”‚   â””â”€â”€ interfaces/      # Domain Interfaces
â”‚   â”œâ”€â”€ application/         # Application Layer
â”‚   â”‚   â”œâ”€â”€ use_cases/       # Use Cases
â”‚   â”‚   â””â”€â”€ repositories/    # Repository Interfaces
â”‚   â””â”€â”€ infrastructure/      # Infrastructure Layer
â”‚       â”œâ”€â”€ repositories/    # Repository Implementations
â”‚       â”œâ”€â”€ events/          # Event Infrastructure
â”‚       â””â”€â”€ sse/            # SSE Infrastructure
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ migrations/         # Database Migrations
â”‚   â””â”€â”€ seeders/           # Database Seeders
â”œâ”€â”€ inertia/               # Frontend React Code
â”‚   â”œâ”€â”€ app/              # App Configuration
â”‚   â”œâ”€â”€ components/       # React Components
â”‚   â”œâ”€â”€ pages/           # Inertia Pages
â”‚   â””â”€â”€ hooks/           # React Hooks
â”œâ”€â”€ config/              # Configuration Files
â”œâ”€â”€ start/               # Bootstrap Files
â””â”€â”€ tests/               # Test Suites
```

### Domain-Driven Design Implementation

#### EntitÃ©s Domaine
```json
{
  "User": {
    "fields": ["uuid", "firstName", "lastName", "username", "email", "password", "isEmailVerified", "avatarUrl", "emailVerifiedAt", "createdAt"],
    "methods": ["create", "updateProfile", "verifyEmail", "changePassword", "toJSON"],
    "validation": "Email unique, password 8+ chars, names non-empty"
  },
  "Player": {
    "fields": ["uuid", "userId", "username", "isReady", "joinedAt"],
    "methods": ["create", "markReady", "markNotReady", "serialize"],
    "purpose": "ReprÃ©sentation d'un utilisateur dans le contexte du jeu"
  },
  "Lobby": {
    "fields": ["uuid", "name", "ownerId", "maxPlayers", "status", "invitationCode", "lobbyPass", "players", "createdAt"],
    "methods": ["create", "addPlayer", "removePlayer", "startGame", "generateInvitationCode", "serialize"],
    "status_values": ["waiting", "starting", "in_game", "finished"],
    "business_rules": ["Max 4 players", "Owner required", "Unique invitation codes"]
  },
  "Game": {
    "fields": ["uuid", "lobbyId", "status", "currentTurn", "players", "deck", "discardPile", "round", "createdAt"],
    "methods": ["create", "playCard", "nextTurn", "endRound", "serialize"],
    "status_values": ["active", "paused", "finished"],
    "game_logic": "Love Letter rules implementation"
  }
}
```

#### Use Cases ImplÃ©mentÃ©s
```json
{
  "authentication": {
    "RegisterUserUseCase": {
      "input": "firstName, lastName, username, email, password",
      "output": "success: boolean, error?: string",
      "validation": "Email uniqueness, password strength"
    },
    "AuthenticateUserUseCase": {
      "input": "email, password",
      "output": "user: User, player: Player",
      "process": "Validation + Player creation/retrieval"
    }
  },
  "lobby_management": {
    "CreateLobbyUseCase": {
      "input": "name, maxPlayers, lobbyPass?, ownerId",
      "output": "lobby: Lobby",
      "features": "Auto invitation code generation"
    },
    "JoinLobbyUseCase": {
      "input": "lobbyUuid, playerId, lobbyPass?",
      "output": "success: boolean, error?: string",
      "validation": "Capacity, password, duplicate check"
    },
    "StartGameUseCase": {
      "input": "lobbyUuid, ownerId",
      "output": "game: Game",
      "requirements": "Owner only, min 2 players"
    }
  },
  "game_logic": {
    "GameActionUseCase": {
      "input": "gameUuid, playerId, action, target?, cardId?",
      "output": "success: boolean, gameState: Game",
      "actions": ["play_card", "target_player", "guess_card", "end_turn"]
    }
  }
}
```

## INFRASTRUCTURE TECHNIQUE

### Base de DonnÃ©es
```json
{
  "migrations": {
    "users": {
      "fields": {
        "user_uuid": "string PRIMARY KEY",
        "full_name": "string NOT NULL",
        "email": "string UNIQUE NOT NULL",
        "password": "string NOT NULL",
        "email_verified_at": "timestamp NULL",
        "deleted_at": "timestamp NULL",
        "created_at": "timestamp DEFAULT NOW",
        "updated_at": "timestamp DEFAULT NOW"
      },
      "indexes": ["email", "deleted_at"]
    },
    "players": {
      "fields": {
        "player_uuid": "string PRIMARY KEY",
        "user_uuid": "string FOREIGN KEY",
        "username": "string NOT NULL",
        "is_ready": "boolean DEFAULT false",
        "joined_at": "timestamp DEFAULT NOW"
      }
    },
    "lobbies": {
      "fields": {
        "lobby_uuid": "string PRIMARY KEY",
        "name": "string NOT NULL",
        "owner_id": "string FOREIGN KEY",
        "max_players": "integer DEFAULT 4",
        "status": "enum(waiting,starting,in_game,finished)",
        "invitation_code": "string UNIQUE",
        "lobby_pass": "string NULL",
        "created_at": "timestamp DEFAULT NOW"
      }
    },
    "games": {
      "fields": {
        "game_uuid": "string PRIMARY KEY",
        "lobby_id": "string FOREIGN KEY",
        "status": "enum(active,paused,finished)",
        "current_turn": "integer DEFAULT 0",
        "round": "integer DEFAULT 1",
        "game_state": "json",
        "created_at": "timestamp DEFAULT NOW"
      }
    }
  }
}
```

### Server-Sent Events (SSE) Architecture
```json
{
  "sse_infrastructure": {
    "EventBus": {
      "purpose": "Central event distribution",
      "methods": ["emit", "subscribe", "unsubscribe"],
      "events": ["lobby.player_joined", "lobby.player_left", "game.card_played", "game.turn_changed"]
    },
    "SSEConnectionManager": {
      "purpose": "Manage client connections",
      "features": ["Connection pooling", "Heartbeat", "Auto-reconnect"],
      "storage": "In-memory Map<userId, connection>"
    },
    "ChannelManager": {
      "purpose": "Route events to specific channels",
      "channels": ["lobby:{uuid}", "game:{uuid}", "user:{uuid}"],
      "authorization": "JWT-based channel access control"
    },
    "EventTransformer": {
      "purpose": "Transform domain events to SSE format",
      "output_format": "{ type: string, data: object, timestamp: ISO8601 }"
    }
  }
}
```

## CONFIGURATION ET ENVIRONNEMENT

### Variables d'Environnement
```json
{
  "required_env_vars": {
    "NODE_ENV": "development|production|test",
    "PORT": "3333",
    "HOST": "localhost",
    "LOG_LEVEL": "info",
    "APP_KEY": "random_32_char_string",
    "DB_CONNECTION": "sqlite|postgres",
    "DB_HOST": "localhost",
    "DB_PORT": "5432",
    "DB_USER": "username",
    "DB_PASSWORD": "password",
    "DB_DATABASE": "infinity_game",
    "SESSION_DRIVER": "cookie",
    "VITE_APP_NAME": "Infinity Game"
  }
}
```

### Imports et Alias
```json
{
  "subpath_imports": {
    "#controllers/*": "./app/controllers/*.js",
    "#models/*": "./app/models/*.js",
    "#domain/*": "./app/domain/*.js",
    "#application/*": "./app/application/*.js",
    "#infrastructure/*": "./app/infrastructure/*.js",
    "#config/*": "./config/*.js",
    "#start/*": "./start/*.js"
  },
  "vite_aliases": {
    "~/": "./inertia/"
  }
}
```

## ROUTING ET API

### Routes Web
```json
{
  "public_routes": {
    "GET /": "Homepage",
    "GET /auth/login": "Login form",
    "POST /auth/login": "Login process",
    "GET /auth/register": "Register form",
    "POST /auth/register": "Register process",
    "GET /lobbies/join/:invitationCode": "Join by invitation"
  },
  "authenticated_routes": {
    "POST /auth/logout": "Logout",
    "GET /lobbies": "Lobby list",
    "POST /lobbies": "Create lobby",
    "GET /lobbies/:uuid": "Lobby detail",
    "POST /lobbies/:uuid/join": "Join lobby",
    "POST /lobbies/:uuid/leave": "Leave lobby",
    "POST /lobbies/:uuid/start": "Start game",
    "GET /games/:uuid": "Game view",
    "POST /games/:uuid/action": "Game action"
  },
  "api_routes": {
    "prefix": "/api/v1",
    "authentication": "required",
    "endpoints": [
      "GET /auth/me",
      "GET /lobbies",
      "GET /lobbies/:uuid",
      "GET /games/:uuid",
      "POST /games/:uuid/action"
    ]
  },
  "sse_routes": {
    "prefix": "/sse",
    "endpoints": [
      "GET /connect",
      "POST /subscribe",
      "POST /unsubscribe",
      "GET /stats"
    ]
  }
}
```

## FRONTEND ARCHITECTURE

### React/Inertia Structure
```json
{
  "pages": {
    "auth/login.tsx": "Login page with form validation",
    "auth/register.tsx": "Registration with toast feedback",
    "lobbies/index.tsx": "Lobby list with real-time updates",
    "lobbies/show.tsx": "Lobby detail with player management",
    "lobbies/create.tsx": "Lobby creation form",
    "games/show.tsx": "Game interface with card play",
    "home.tsx": "Landing page"
  },
  "components": {
    "layout": "Main app layout with navigation",
    "lobby": "Lobby-specific components",
    "game": "Game UI components",
    "auth": "Authentication forms"
  },
  "hooks": {
    "useSSE": "Server-Sent Events client",
    "useFlashMessages": "Toast notifications from backend",
    "useAuth": "Authentication state management"
  }
}
```

### Toast System
```json
{
  "implementation": "Custom FlashMessages component",
  "trigger": "Inertia.js flash messages",
  "styling": "TailwindCSS (green success, red error)",
  "duration": "5 seconds auto-dismiss",
  "position": "top-right fixed",
  "integration": "Integrated in main app.tsx"
}
```

## TESTING STRATEGY

### Test Configuration
```json
{
  "unit_tests": {
    "framework": "Jest",
    "coverage": "app/** directory",
    "focus": "Domain entities, Use cases, Value objects"
  },
  "integration_tests": {
    "framework": "@japa/runner",
    "database": "SQLite in-memory",
    "reset": "Before each test",
    "scope": "API endpoints, Database operations"
  },
  "mutation_testing": {
    "framework": "Stryker",
    "target": "TypeScript files",
    "threshold": "80% mutation score"
  }
}
```

## DEPLOYMENT ET BUILD

### Build Process
```json
{
  "development": {
    "command": "node ace serve --hmr",
    "features": ["Hot reload", "TypeScript compilation", "Vite HMR"]
  },
  "production": {
    "build": "node ace build",
    "start": "NODE_ENV=production node bin/server.js",
    "assets": "Vite build process",
    "optimization": "Minification, tree-shaking"
  }
}
```

## SÃ‰CURITÃ‰

### Mesures ImplÃ©mentÃ©es
```json
{
  "authentication": {
    "password_hashing": "Argon2 via @adonisjs/core/hash",
    "session_management": "Encrypted cookies",
    "csrf_protection": "@adonisjs/shield"
  },
  "authorization": {
    "middleware": "auth middleware on protected routes",
    "sse_channels": "JWT-based channel authorization",
    "lobby_access": "Owner/player validation"
  },
  "data_validation": {
    "input_validation": "VineJS schemas",
    "sql_injection": "Lucid ORM parameterized queries",
    "xss_protection": "Edge.js template escaping"
  }
}
```

## PERFORMANCE

### Optimisations
```json
{
  "database": {
    "indexes": "On frequently queried fields",
    "connection_pooling": "Lucid ORM built-in",
    "query_optimization": "N+1 prevention with preloading"
  },
  "frontend": {
    "code_splitting": "Vite automatic splitting",
    "lazy_loading": "React.lazy for components",
    "asset_optimization": "Vite minification"
  },
  "real_time": {
    "sse_connection_pooling": "Efficient memory usage",
    "event_batching": "Reduce network overhead",
    "heartbeat_optimization": "Connection health monitoring"
  }
}
```

## Ã‰TAT ACTUEL DU PROJET

### FonctionnalitÃ©s ComplÃ©tÃ©es âœ…
```json
{
  "backend_core": {
    "domain_entities": "User, Player, Lobby, Game - 100%",
    "use_cases": "Auth, Lobby management, Game logic - 100%",
    "database": "Migrations, models, repositories - 100%",
    "api_endpoints": "REST API complet - 100%",
    "sse_infrastructure": "Real-time events - 100%"
  },
  "authentication": {
    "user_registration": "Avec validation et persistance - 100%",
    "user_login": "Session-based auth - 100%",
    "password_security": "Hashing Argon2 - 100%",
    "middleware_protection": "Routes protÃ©gÃ©es - 100%"
  },
  "frontend_integration": {
    "react_inertia": "Pages et composants - 100%",
    "toast_notifications": "Flash messages - 100%",
    "sse_client": "Real-time updates - 100%",
    "responsive_ui": "TailwindCSS - 100%"
  }
}
```

### FonctionnalitÃ©s En Cours ðŸš§
```json
{
  "ui_consistency": {
    "shadcn_migration": "Migration vers @tyfo.dev/ui",
    "storybook_integration": "Documentation composants",
    "design_system": "CohÃ©rence visuelle"
  },
  "advanced_features": {
    "lobby_invitations": "Codes d'invitation - 90%",
    "game_spectators": "Mode observateur",
    "player_statistics": "Historique des parties"
  }
}
```

## CHOIX TECHNIQUES JUSTIFIÃ‰S

### Pourquoi AdonisJS ?
- **TypeScript natif**: Pas de configuration supplÃ©mentaire
- **Architecture mature**: MVC + DDD support
- **Ã‰cosystÃ¨me complet**: Auth, ORM, Validation intÃ©grÃ©s
- **Performance**: V8 optimizations, async/await natif
- **MaintenabilitÃ©**: Structure claire, conventions Ã©tablies

### Pourquoi Inertia.js ?
- **SimplicitÃ©**: Pas de API REST complexe
- **Performance**: Pas de double rendu (SPA + SSR)
- **DX**: DÃ©veloppement comme une SPA, dÃ©ploiement comme une app traditionnelle
- **SEO**: Rendu cÃ´tÃ© serveur natif
- **Maintenance**: Une seule base de code

### Pourquoi Server-Sent Events ?
- **SimplicitÃ©**: Plus simple que WebSockets
- **FiabilitÃ©**: Reconnexion automatique
- **CompatibilitÃ©**: Support navigateur natif
- **ScalabilitÃ©**: Moins de ressources serveur
- **Debugging**: Outils de dÃ©veloppement standard

## PATTERNS ET CONVENTIONS

### Domain-Driven Design
```json
{
  "entities": "Logique mÃ©tier encapsulÃ©e",
  "value_objects": "Objets immuables (Status, Result)",
  "use_cases": "Actions mÃ©tier isolÃ©es",
  "repositories": "Abstraction de persistance",
  "events": "Communication dÃ©couplÃ©e"
}
```

### Hexagonal Architecture
```json
{
  "domain": "CÅ“ur mÃ©tier indÃ©pendant",
  "application": "Orchestration des use cases",
  "infrastructure": "DÃ©tails techniques (DB, SSE, HTTP)"
}
```

### Code Quality
```json
{
  "typescript": "Strict mode, no any",
  "eslint": "@adonisjs/eslint-config",
  "prettier": "@adonisjs/prettier-config",
  "testing": "TDD approach, 80%+ coverage",
  "documentation": "JSDoc pour les APIs publiques"
}
```

---

**DerniÃ¨re mise Ã  jour**: 2025-08-14  
**Version**: 1.0.0  
**Statut**: Production-ready backend, Frontend intÃ©grÃ©  
**Prochaine Ã©tape**: Migration UI vers shadcn/ui complÃ¨te
